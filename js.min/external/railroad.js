"use strict";const T={};export default T;export const Options={DEBUG:!1,VS:8,AR:10,DIAGRAM_CLASS:"railroad-diagram",STROKE_ODD_PIXEL_LENGTH:!0,INTERNAL_ALIGNMENT:"center",CHAR_WIDTH:8.5,COMMENT_CHAR_WIDTH:7,ESCAPE_HTML:!0},defaultCSS=`
	svg {
		background-color: hsl(30,20%,95%);
	}
	path {
		stroke-width: 3;
		stroke: black;
		fill: rgba(0,0,0,0);
	}
	text {
		font: bold 14px monospace;
		text-anchor: middle;
		white-space: pre;
	}
	text.diagram-text {
		font-size: 12px;
	}
	text.diagram-arrow {
		font-size: 16px;
	}
	text.label {
		text-anchor: start;
	}
	text.comment {
		font: italic 12px monospace;
	}
	g.non-terminal text {
		/*font-style: italic;*/
	}
	rect {
		stroke-width: 3;
		stroke: black;
		fill: hsl(120,100%,90%);
	}
	rect.group-box {
		stroke: gray;
		stroke-dasharray: 10 5;
		fill: none;
	}
	path.diagram-text {
		stroke-width: 3;
		stroke: black;
		fill: white;
		cursor: help;
	}
	g.diagram-text:hover path.diagram-text {
		fill: #eee;
	}`;export class FakeSVG{constructor(t,e,r){r?this.children=r:this.children=[],this.tagName=t,this.attrs=k(e,{})}format(t,e,r){}addTo(t){if(t instanceof FakeSVG)return t.children.push(this),this;var e=this.toSVG();return t.appendChild(e),e}toSVG(){var t=G(this.tagName,this.attrs);return typeof this.children=="string"?t.textContent=this.children:this.children.forEach(function(e){t.appendChild(e.toSVG())}),t}toString(){var t="<"+this.tagName,e=this.tagName=="g"||this.tagName=="svg";for(var r in this.attrs)t+=" "+r+'="'+(this.attrs[r]+"").replace(/&/g,"&amp;").replace(/"/g,"&quot;")+'"';return t+=">",e&&(t+=`
`),typeof this.children=="string"?t+=O(this.children):this.children.forEach(function(h){t+=h}),t+="</"+this.tagName+`>
`,t}toTextDiagram(){return new TextDiagram(0,0,[])}toText(){var t=this.toTextDiagram(),e=t.lines.join(`
`)+`
`;return Options.ESCAPE_HTML&&(e=e.replace("&","&amp;").replace("<","&lt;").replace(">","&gt;").replace('"',"&quot;")),e}walk(t){t(this)}}export class Path extends FakeSVG{constructor(t,e){super("path"),this.attrs.d="M"+t+" "+e}m(t,e){return this.attrs.d+="m"+t+" "+e,this}h(t){return this.attrs.d+="h"+t,this}right(t){return this.h(Math.max(0,t))}left(t){return this.h(-Math.max(0,t))}v(t){return this.attrs.d+="v"+t,this}down(t){return this.v(Math.max(0,t))}up(t){return this.v(-Math.max(0,t))}arc(t){var e=Options.AR,r=Options.AR;(t[0]=="e"||t[1]=="w")&&(e*=-1),(t[0]=="s"||t[1]=="n")&&(r*=-1);var h;return t=="ne"||t=="es"||t=="sw"||t=="wn"?h=1:h=0,this.attrs.d+="a"+Options.AR+" "+Options.AR+" 0 0 "+h+" "+e+" "+r,this}arc_8(t,e){const r=Options.AR,h=1/Math.sqrt(2)*r,s=r-h;let a="a "+r+" "+r+" 0 0 "+(e=="cw"?"1":"0")+" ";const n=t+e,u=n=="ncw"?[h,s]:n=="necw"?[s,h]:n=="ecw"?[-s,h]:n=="secw"?[-h,s]:n=="scw"?[-h,-s]:n=="swcw"?[-s,-h]:n=="wcw"?[s,-h]:n=="nwcw"?[h,-s]:n=="nccw"?[-h,s]:n=="nwccw"?[-s,h]:n=="wccw"?[s,h]:n=="swccw"?[h,s]:n=="sccw"?[h,-s]:n=="seccw"?[s,-h]:n=="eccw"?[-s,-h]:n=="neccw"?[-h,-s]:null;return a+=u.join(" "),this.attrs.d+=a,this}l(t,e){return this.attrs.d+="l"+t+" "+e,this}format(){return this.attrs.d+="h.5",this}toTextDiagram(){return new TextDiagram(0,0,[])}}export class DiagramMultiContainer extends FakeSVG{constructor(t,e,r,h){super(t,r,h),this.items=e.map(I)}walk(t){t(this),this.items.forEach(e=>e.walk(t))}}export class Diagram extends DiagramMultiContainer{constructor(...t){super("svg",t,{class:Options.DIAGRAM_CLASS}),this.items[0]instanceof Start||this.items.unshift(new Start),this.items[this.items.length-1]instanceof End||this.items.push(new End),this.up=this.down=this.height=this.width=0;for(const e of this.items)this.width+=e.width+(e.needsSpace?20:0),this.up=Math.max(this.up,e.up-this.height),this.height+=e.height,this.down=Math.max(this.down-e.height,e.down);this.formatted=!1}format(t,e,r,h){t=k(t,20),e=k(e,t,20),r=k(r,t,20),h=k(h,e,20);var s=h,a=t;a+=this.up;for(var n=new FakeSVG("g",Options.STROKE_ODD_PIXEL_LENGTH?{transform:"translate(.5 .5)"}:{}),u=0;u<this.items.length;u++){var o=this.items[u];o.needsSpace&&(new Path(s,a).h(10).addTo(n),s+=10),o.format(s,a,o.width).addTo(n),s+=o.width,a+=o.height,o.needsSpace&&(new Path(s,a).h(10).addTo(n),s+=10)}return this.attrs.width=this.width+h+e,this.attrs.height=this.up+this.height+this.down+t+r,this.attrs.viewBox="0 0 "+this.attrs.width+" "+this.attrs.height,n.addTo(this),this.formatted=!0,this}addTo(t){if(!t){var e=document.getElementsByTagName("script");e=e[e.length-1],t=e.parentNode}return super.addTo.call(this,t)}toSVG(){return this.formatted||this.format(),super.toSVG.call(this)}toString(){return this.formatted||this.format(),super.toString.call(this)}toStandalone(t){this.formatted||this.format();const e=new FakeSVG("style",{},t||defaultCSS);this.children.push(e),this.attrs.xmlns="http://www.w3.org/2000/svg",this.attrs["xmlns:xlink"]="http://www.w3.org/1999/xlink";const r=super.toString.call(this);return this.children.pop(),delete this.attrs.xmlns,r}toTextDiagram(){var[t]=TextDiagram._getParts(["separator"]),e=this.items[0].toTextDiagram();for(const h of this.items.slice(1)){var r=h.toTextDiagram();h.needsSpace&&(r=r.expand(1,1,0,0)),e=e.appendRight(r,t)}return e}}T.Diagram=(...w)=>new Diagram(...w);export class ComplexDiagram extends FakeSVG{constructor(...t){var e=new Diagram(...t);return e.items[0]=new Start({type:"complex"}),e.items[e.items.length-1]=new End({type:"complex"}),e}}T.ComplexDiagram=(...w)=>new ComplexDiagram(...w);export class Sequence extends DiagramMultiContainer{constructor(...t){super("g",t);var e=this.items.length;this.needsSpace=!0,this.up=this.down=this.height=this.width=0;for(var r=0;r<this.items.length;r++){var h=this.items[r];this.width+=h.width+(h.needsSpace?20:0),this.up=Math.max(this.up,h.up-this.height),this.height+=h.height,this.down=Math.max(this.down-h.height,h.down)}this.items[0].needsSpace&&(this.width-=10),this.items[this.items.length-1].needsSpace&&(this.width-=10),Options.DEBUG&&(this.attrs["data-updown"]=this.up+" "+this.height+" "+this.down,this.attrs["data-type"]="sequence")}format(t,e,r){var h=b(r,this.width);new Path(t,e).h(h[0]).addTo(this),new Path(t+h[0]+this.width,e+this.height).h(h[1]).addTo(this),t+=h[0];for(var s=0;s<this.items.length;s++){var a=this.items[s];a.needsSpace&&s>0&&(new Path(t,e).h(10).addTo(this),t+=10),a.format(t,e,a.width).addTo(this),t+=a.width,e+=a.height,a.needsSpace&&s<this.items.length-1&&(new Path(t,e).h(10).addTo(this),t+=10)}return this}toTextDiagram(){var[t]=TextDiagram._getParts(["separator"]),e=new TextDiagram(0,0,[""]);for(const h of this.items){var r=h.toTextDiagram();h.needsSpace&&(r=r.expand(1,1,0,0)),e=e.appendRight(r,t)}return e}}T.Sequence=(...w)=>new Sequence(...w);export class Stack extends DiagramMultiContainer{constructor(...t){if(super("g",t),t.length===0)throw new RangeError("Stack() must have at least one child.");this.width=Math.max.apply(null,this.items.map(function(s){return s.width+(s.needsSpace?20:0)})),this.items.length>1&&(this.width+=Options.AR*2),this.needsSpace=!0,this.up=this.items[0].up,this.down=this.items[this.items.length-1].down,this.height=0;for(var e=this.items.length-1,r=0;r<this.items.length;r++){var h=this.items[r];this.height+=h.height,r>0&&(this.height+=Math.max(Options.AR*2,h.up+Options.VS)),r<e&&(this.height+=Math.max(Options.AR*2,h.down+Options.VS))}Options.DEBUG&&(this.attrs["data-updown"]=this.up+" "+this.height+" "+this.down,this.attrs["data-type"]="stack")}format(t,e,r){var h=b(r,this.width);new Path(t,e).h(h[0]).addTo(this),t+=h[0];var s=t;this.items.length>1&&(new Path(t,e).h(Options.AR).addTo(this),t+=Options.AR);for(var a=0;a<this.items.length;a++){var n=this.items[a],u=this.width-(this.items.length>1?Options.AR*2:0);n.format(t,e,u).addTo(this),t+=u,e+=n.height,a!==this.items.length-1&&(new Path(t,e).arc("ne").down(Math.max(0,n.down+Options.VS-Options.AR*2)).arc("es").left(u).arc("nw").down(Math.max(0,this.items[a+1].up+Options.VS-Options.AR*2)).arc("ws").addTo(this),e+=Math.max(n.down+Options.VS,Options.AR*2)+Math.max(this.items[a+1].up+Options.VS,Options.AR*2),t=s+Options.AR)}return this.items.length>1&&(new Path(t,e).h(Options.AR).addTo(this),t+=Options.AR),new Path(t,e).h(h[1]).addTo(this),this}toTextDiagram(){var[t,e,r,h,s,a]=TextDiagram._getParts(["corner_bot_left","corner_bot_right","corner_top_left","corner_top_right","line","line_vertical"]),n=[];for(const v of this.items)n.push(v.toTextDiagram());var u=Math.max(...n.map(function(v){return v.width})),o=[],l=[],p=new TextDiagram(0,0,[s.repeat(u)]),i=null;for(var[d,c]of V(n)){if(d==0){o.push(s+s);for(var f=0;f<c.height-c.entry-1;f++)o.push("  ")}else{for(i=i.appendBelow(p,[]),o.push(r+s),f=0;f<c.entry;f++)o.push(a+" ");for(o.push(t+s),f=0;f<c.height-c.entry-1;f++)o.push("  ");for(f=0;f<c.exit;f++)l.push("  ")}if(d<n.length-1){for(l.push(s+h),f=0;f<c.height-c.exit-1;f++)l.push(" "+a);l.push(s+e)}else l.push(s+s);var[m,g]=TextDiagram._gaps(u,c.width);c=c.expand(m,g,0,0),d==0?i=c:i=i.appendBelow(c,[])}var _=new TextDiagram(0,0,o);i=_.appendRight(i,"");var M=new TextDiagram(0,l.length-1,l);return i=i.appendRight(M,""),i}}T.Stack=(...w)=>new Stack(...w);export class OptionalSequence extends DiagramMultiContainer{constructor(...t){if(super("g",t),t.length===0)throw new RangeError("OptionalSequence() must have at least one child.");if(t.length===1)return new Sequence(t);var e=Options.AR;this.needsSpace=!1,this.width=0,this.up=0,this.height=B(this.items,function(n){return n.height}),this.down=this.items[0].down;for(var r=0,h=0;h<this.items.length;h++){var s=this.items[h];this.up=Math.max(this.up,Math.max(e*2,s.up+Options.VS)-r),r+=s.height,h>0&&(this.down=Math.max(this.height+this.down,r+Math.max(e*2,s.down+Options.VS))-this.height);var a=(s.needsSpace?10:0)+s.width;h===0?this.width+=e+Math.max(a,e):this.width+=e*2+Math.max(a,e)+e}Options.DEBUG&&(this.attrs["data-updown"]=this.up+" "+this.height+" "+this.down,this.attrs["data-type"]="optseq")}format(t,e,r){var h=Options.AR,s=b(r,this.width);new Path(t,e).right(s[0]).addTo(this),new Path(t+s[0]+this.width,e+this.height).right(s[1]).addTo(this),t+=s[0];for(var a=e-this.up,n=this.items.length-1,u=0;u<this.items.length;u++){var o=this.items[u],l=o.needsSpace?10:0,p=o.width+l;u===0?(new Path(t,e).arc("se").up(e-a-h*2).arc("wn").right(p-h).arc("ne").down(e+o.height-a-h*2).arc("ws").addTo(this),new Path(t,e).right(l+h).addTo(this),o.format(t+l+h,e,o.width).addTo(this),t+=p+h,e+=o.height):u<n?(new Path(t,a).right(h*2+Math.max(p,h)+h).arc("ne").down(e-a+o.height-h*2).arc("ws").addTo(this),new Path(t,e).right(h*2).addTo(this),o.format(t+h*2,e,o.width).addTo(this),new Path(t+o.width+h*2,e+o.height).right(l+h).addTo(this),new Path(t,e).arc("ne").down(o.height+Math.max(o.down+Options.VS,h*2)-h*2).arc("ws").right(p-h).arc("se").up(o.down+Options.VS-h*2).arc("wn").addTo(this),t+=h*2+Math.max(p,h)+h,e+=o.height):(new Path(t,e).right(h*2).addTo(this),o.format(t+h*2,e,o.width).addTo(this),new Path(t+h*2+o.width,e+o.height).right(l+h).addTo(this),new Path(t,e).arc("ne").down(o.height+Math.max(o.down+Options.VS,h*2)-h*2).arc("ws").right(p-h).arc("se").up(o.down+Options.VS-h*2).arc("wn").addTo(this))}return this}toTextDiagram(){var[t,e,r,h,s,a]=TextDiagram._getParts(["line","line_vertical","roundcorner_bot_left","roundcorner_bot_right","roundcorner_top_left","roundcorner_top_right"]),n=[];for(const x of this.items)n.push(x.toTextDiagram());for(var u=Math.max(...n.map(function(x){return x.entry})),o=Math.max(...n.slice(0,-1).map(function(x){return x.entry})),l=u-o,p=[],i=0;i<l;i++)p.push("  ");for(p.push(s+t),i=0;i<o;i++)p.push(e+" ");p.push(h+t);var d=new TextDiagram(p.length-1,p.length-1,p);for(const[x,S]of V(n)){if(x>0){for(p=[],i=0;i<l;i++)p.push("  ");for(p.push(t+t),i=0;i<d.exit-l-1;i++)p.push("  ");for(p.push(t+a),i=0;i<S.height-S.entry-1;i++)p.push(" "+e);p.push(" "+r);var c=new TextDiagram(d.exit,d.exit,p);for(d=d.appendRight(c,""),p=[],i=0;i<l;i++)p.push("  ");var f=x<n.length-1?t:" ";for(p.push(t+a+f),i=0;i<d.exit-l-1;i++)p.push(" "+e+" ");for(p.push(t+r+t),i=0;i<S.height-S.entry-1;i++)p.push("   ");p.push(t+t+t);var m=new TextDiagram(d.exit,d.exit,p);d=d.appendRight(m,"")}var g=new TextDiagram(0,0,[]);if(x<n.length-1){for(p=[],p.push(t.repeat(S.width)),i=0;i<o-S.entry;i++)p.push(" ".repeat(S.width));var _=new TextDiagram(0,0,p);g=g.appendBelow(_,[])}if(g=g.appendBelow(S,[],!0,!0),x>0){var M=new TextDiagram(0,0,[t.repeat(S.width)]);g=g.appendBelow(M,[])}if(d=d.appendRight(g,""),0<x){for(p=[],i=0;i<l;i++)p.push("  ");var v=x<n.length-1?t:" ";for(p.push(v.repeat(2)),i=0;i<d.exit-l-1;i++)p.push("  ");for(p.push(t+s),i=0;i<g.height-g.exit-2;i++)p.push(" "+e);p.push(t+h);var A=new TextDiagram(d.exit,d.exit,p);d=d.appendRight(A,"")}}return d}}T.OptionalSequence=(...w)=>new OptionalSequence(...w);export class AlternatingSequence extends DiagramMultiContainer{constructor(...t){if(super("g",t),t.length===1)return new Sequence(t);if(t.length!==2)throw new RangeError("AlternatingSequence() must have one or two children.");this.needsSpace=!1;const e=Options.AR,r=Options.VS,h=Math.max,s=this.items[0],a=this.items[1],n=1/Math.sqrt(2)*e*2,u=(1-1/Math.sqrt(2))*e*2,o=Math.max(e,Options.VS),l=o-u+n,p=h(e+e,o/2+e+e,o/2+r+s.down);this.up=p+s.height+s.up;const i=h(e+e,o/2+e+e,o/2+r+a.up);this.down=i+a.height+a.down,this.height=0;const d=2*(s.needsSpace?10:0)+s.width,c=2*(a.needsSpace?10:0)+a.width;this.width=2*e+h(d,l,c)+2*e,Options.DEBUG&&(this.attrs["data-updown"]=this.up+" "+this.height+" "+this.down,this.attrs["data-type"]="altseq")}format(t,e,r){const h=Options.AR,s=b(r,this.width);new Path(t,e).right(s[0]).addTo(this),t+=s[0],new Path(t+this.width,e).right(s[1]).addTo(this);const a=this.items[0],n=this.items[1],u=this.up-a.up,o=this.up-a.up-a.height;new Path(t,e).arc("se").up(u-2*h).arc("wn").addTo(this),a.format(t+2*h,e-u,this.width-4*h).addTo(this),new Path(t+this.width-2*h,e-o).arc("ne").down(o-2*h).arc("ws").addTo(this);const l=this.down-n.down-n.height,p=this.down-n.down;new Path(t,e).arc("ne").down(l-2*h).arc("ws").addTo(this),n.format(t+2*h,e+l,this.width-4*h).addTo(this),new Path(t+this.width-2*h,e+p).arc("se").up(p-2*h).arc("wn").addTo(this);const i=1/Math.sqrt(2)*h*2,d=(1-1/Math.sqrt(2))*h*2,c=Math.max(h,Options.VS),f=c-d+i,m=(this.width-4*h-f)/2;return new Path(t+h,e-c/2-h).arc("ws").right(m).arc_8("n","cw").l(f-i,c-d).arc_8("sw","ccw").right(m).arc("ne").addTo(this),new Path(t+h,e+c/2+h).arc("wn").right(m).arc_8("s","ccw").l(f-i,-(c-d)).arc_8("nw","cw").right(m).arc("se").addTo(this),this}toTextDiagram(){for(var[t,e,r,h,s,a,n,u,o]=TextDiagram._getParts(["cross_diag","roundcorner_bot_left","roundcorner_bot_right","roundcorner_top_left","roundcorner_top_right","line","line_vertical","tee_left","tee_right"]),l=this.items[0].toTextDiagram(),p=this.items[1].toTextDiagram(),i=TextDiagram._maxWidth(l,p),[d,c]=TextDiagram._gaps(i,0),f=[],m=[],g=[],[_,M]=TextDiagram._gaps(l.width,0),v=l.expand(d-_,c-M,0,0),A=0;A<v.entry;A++)f.push("  ");for(f.push(h+a),A=0;A<v.height-v.entry-1;A++)f.push(n+" ");for(f.push(e+a),A=0;A<v.exit;A++)m.push("  ");for(m.push(a+s),A=0;A<v.height-v.exit-1;A++)m.push(" "+n);for(m.push(a+r),g.push(a.repeat(d-1)+s+" "+h+a.repeat(c-2)),g.push(" ".repeat(d-1)+" "+t+" "+" ".repeat(c-2)),g.push(a.repeat(d-1)+r+" "+e+a.repeat(c-2)),f.push("  "),m.push("  "),[_,M]=TextDiagram._gaps(p.width,0),p=p.expand(d-_,c-M,0,0),v=v.appendBelow(p,g,!0,!0),f.push(h+a),A=0;A<p.entry;A++)f.push(n+" ");for(f.push(e+a),m.push(a+s),A=0;A<p.exit;A++)m.push(" "+n);m.push(a+r),v=v.alter(l.height+Math.trunc(g.length/2),l.height+Math.trunc(g.length/2));var x=new TextDiagram(l.height+Math.trunc(g.length/2),l.height+Math.trunc(g.length/2),f),S=new TextDiagram(l.height+Math.trunc(g.length/2),l.height+Math.trunc(g.length/2),m);return v=x.appendRight(v,"").appendRight(S,""),v=new TextDiagram(1,1,[h,u,e]).appendRight(v,"").appendRight(new TextDiagram(1,1,[s,o,r]),""),v}}T.AlternatingSequence=(...w)=>new AlternatingSequence(...w);export class Choice extends DiagramMultiContainer{constructor(t,...e){if(super("g",e),typeof t!="number"||t!==Math.floor(t))throw new TypeError("The first argument of Choice() must be an integer.");if(t<0||t>=e.length)throw new RangeError("The first argument of Choice() must be an index for one of the items.");this.normal=t,this.width=C(this.items,u=>u.width)+Options.AR*4;var r=this.items[0],h=this.items[e.length-1],s=this.items[t];this.separators=Array.from({length:e.length-1},u=>0),this.up=0;for(var a,n=t-1;n>=0;n--){n==t-1?a=Options.AR*2:a=Options.AR;let u=this.items[n],o=this.items[n+1],l=o.up+Options.VS+u.down+u.height,p=o.height+o.up+Options.VS+u.down,i=Options.VS;(p<a||l<a)&&(i+=Math.max(a-l,a-p)),this.separators[n]=i,this.up+=o.up+i+u.down+u.height}this.up+=r.up,this.height=s.height,this.down=0;for(var n=t+1;n<this.items.length;n++){n==t+1?a=Options.AR*2:a=Options.AR;let o=this.items[n],l=this.items[n-1],p=l.height+l.down+Options.VS+o.up,i=l.down+Options.VS+o.up+o.height,d=Options.VS;(p<a||i<a)&&(d+=Math.max(a-p,a-i)),this.separators[n-1]=d,this.down+=l.down+d+o.up+o.height}this.down+=h.down,Options.DEBUG&&(this.attrs["data-updown"]=this.up+" "+this.height+" "+this.down,this.attrs["data-type"]="choice")}format(t,e,r){var h=b(r,this.width);new Path(t,e).h(h[0]).addTo(this),new Path(t+h[0]+this.width,e+this.height).h(h[1]).addTo(this),t+=h[0];for(var s=this.items.length-1,a=this.width-Options.AR*4,u=0,n=this.normal-1;n>=0;n--){let o=this.items[n],l=this.items[n+1];u+=l.up+this.separators[n]+o.down+o.height,new Path(t,e).arc("se").up(u-Options.AR*2).arc("wn").addTo(this),o.format(t+Options.AR*2,e-u,a).addTo(this),new Path(t+Options.AR*2+a,e-u+o.height).arc("ne").down(u-o.height+this.height-Options.AR*2).arc("ws").addTo(this)}new Path(t,e).right(Options.AR*2).addTo(this),this.items[this.normal].format(t+Options.AR*2,e,a).addTo(this),new Path(t+Options.AR*2+a,e+this.height).right(Options.AR*2).addTo(this);for(var u=0,n=this.normal+1;n<=s;n++){let l=this.items[n],p=this.items[n-1];u+=p.height+p.down+this.separators[n-1]+l.up,new Path(t,e).arc("ne").down(u-Options.AR*2).arc("ws").addTo(this),l.format||console.log(l),l.format(t+Options.AR*2,e+u,a).addTo(this),new Path(t+Options.AR*2+a,e+u+l.height).arc("se").up(u-Options.AR*2+l.height-this.height).arc("wn").addTo(this)}return this}toTextDiagram(){var[t,e,r,h,s,a,n]=TextDiagram._getParts(["cross","line","line_vertical","roundcorner_bot_left","roundcorner_bot_right","roundcorner_top_left","roundcorner_top_right"]),u=[];for(const R of this.items)u.push(R.toTextDiagram().expand(1,1,0,0));var o=Math.max(...u.map(function(R){return R.width})),l=new TextDiagram(0,0,[]);for(var[p,i]of V(u)){var[d,c]=TextDiagram._gaps(o,i.width);i=i.expand(d,c,0,0);for(var f=!0,m=[],g=[],_=0;_<i.height;_++)m.push(r),g.push(r);var M=!1,v=!1;if(p<=this.normal&&(m[i.entry]=a,g[i.exit]=n,p==0)){for(f=!1,_=0;_<i.entry;_++)m[_]=" ";for(_=0;_<i.exit;_++)g[_]=" "}if(p>=this.normal&&(m[i.entry]=h,g[i.exit]=s,p==0&&(f=!1),p==this.items.length-1)){for(_=i.entry+1;_<i.height;_++)m[_]=" ";for(_=i.exit+1;_<i.height;_++)g[_]=" "}p==this.normal&&(m[i.entry]=t,g[i.exit]=t,M=!0,v=!0,p==0&&p==this.items.length-1?(m[i.entry]=e,g[i.exit]=e):p==0?(m[i.entry]=n,g[i.exit]=a):p==this.items.length-1&&(m[i.entry]=s,g[i.exit]=h));var A=new TextDiagram(i.entry,i.entry,m),x=new TextDiagram(i.exit,i.exit,g);i=A.appendRight(i,"").appendRight(x,"");var S=f?[r+" ".repeat(TextDiagram._maxWidth(l,i)-2)+r]:[];l=l.appendBelow(i,S,M,v)}return l}}T.Choice=(...w)=>new Choice(...w);export class HorizontalChoice extends DiagramMultiContainer{constructor(...t){if(super("g",t),t.length===0)throw new RangeError("HorizontalChoice() must have at least one child.");if(t.length===1)return new Sequence(t);const e=this.items.slice(0,-1),r=this.items.slice(1,-1),h=this.items[0],s=this.items[this.items.length-1];this.needsSpace=!1,this.width=Options.AR,this.width+=Options.AR*2*(this.items.length-1),this.width+=B(this.items,a=>a.width+(a.needsSpace?20:0)),this.width+=s.height>0?Options.AR:0,this.width+=Options.AR,this.height=0,this._upperTrack=Math.max(Options.AR*2,Options.VS,C(e,a=>a.up)+Options.VS),this.up=Math.max(this._upperTrack,s.up),this._lowerTrack=Math.max(Options.VS,C(r,a=>a.height+Math.max(a.down+Options.VS,Options.AR*2)),s.height+s.down+Options.VS),h.height<this._lowerTrack&&(this._lowerTrack=Math.max(this._lowerTrack,h.height+Options.AR*2)),this.down=Math.max(this._lowerTrack,h.height+h.down),Options.DEBUG&&(this.attrs["data-updown"]=this.up+" "+this.height+" "+this.down,this.attrs["data-type"]="horizontalchoice")}format(t,e,r){var h=b(r,this.width);new Path(t,e).h(h[0]).addTo(this),new Path(t+h[0]+this.width,e+this.height).h(h[1]).addTo(this),t+=h[0];const s=this.items[0],a=this.items[this.items.length-1],n=this.items.slice(1),u=this.items.slice(0,-1);var o=B(u,d=>d.width+(d.needsSpace?20:0))+(this.items.length-2)*Options.AR*2-Options.AR;new Path(t,e).arc("se").v(-(this._upperTrack-Options.AR*2)).arc("wn").h(o).addTo(this);var l=B(n,d=>d.width+(d.needsSpace?20:0))+(this.items.length-2)*Options.AR*2+(a.height>0?Options.AR:0)-Options.AR,p=t+Options.AR+s.width+(s.needsSpace?20:0)+Options.AR*2;new Path(p,e+this._lowerTrack).h(l).arc("se").v(-(this._lowerTrack-Options.AR*2)).arc("wn").addTo(this);for(const[d,c]of V(this.items)){d===0?(new Path(t,e).h(Options.AR).addTo(this),t+=Options.AR):(new Path(t,e-this._upperTrack).arc("ne").v(this._upperTrack-Options.AR*2).arc("ws").addTo(this),t+=Options.AR*2);var i=c.width+(c.needsSpace?20:0);c.format(t,e,i).addTo(this),t+=i,d===this.items.length-1?c.height===0?new Path(t,e).h(Options.AR).addTo(this):new Path(t,e+c.height).arc("se").addTo(this):d===0&&c.height>this._lowerTrack?c.height-this._lowerTrack>=Options.AR*2?new Path(t,e+c.height).arc("se").v(this._lowerTrack-c.height+Options.AR*2).arc("wn").addTo(this):new Path(t,e+c.height).l(Options.AR*2,this._lowerTrack-c.height).addTo(this):new Path(t,e+c.height).arc("ne").v(this._lowerTrack-c.height-Options.AR*2).arc("ws").addTo(this)}return this}toTextDiagram(){var[t,e,r,h,s,a]=TextDiagram._getParts(["line","line_vertical","roundcorner_bot_left","roundcorner_bot_right","roundcorner_top_left","roundcorner_top_right"]),n=[];for(const R of this.items)n.push(R.toTextDiagram());for(var u=Math.max(...n.map(function(R){return R.entry})),o=Math.max(...n.slice(0,-1).map(function(R){return R.entry})),l=u-o,p=Math.max(...n.slice(1).map(function(R){return R.height-Math.min(R.entry,R.exit)-1})),i=[],d=0;d<l;d++)i.push("  ");for(i.push(s+t),d=0;d<o;d++)i.push(e+" ");i.push(h+t);var c=new TextDiagram(i.length-1,i.length-1,i);for(const[R,E]of V(n)){if(R>0){for(i=[],d=0;d<l;d++)i.push("  ");var f=R==n.length-1?" ":t;for(i.push(a+f),d=0;d<o;d++)i.push(e+" ");for(i.push(r+t),d=0;d<p;d++)i.push(e+" ");i.push(t+t);var m=new TextDiagram(c.exit,c.exit,i);c=c.appendRight(m,"")}var g=new TextDiagram(0,0,[]);if(R<n.length-1){for(i=[],i.push(t.repeat(E.width)),d=0;d<o-E.entry;d++)i.push(" ".repeat(E.width));var _=new TextDiagram(0,0,i);g=g.appendBelow(_,[])}if(g=g.appendBelow(E,[],!0,!0),R>0){for(i=[],d=0;d<p-(E.height-E.entry)+1;d++)i.push(" ".repeat(E.width));i.push(t.repeat(E.width));var M=new TextDiagram(0,0,i);g=g.appendBelow(M,[])}if(c=c.appendRight(g,""),R<n.length-1){for(i=[],d=0;d<l;d++)i.push("  ");for(i.push(t+t),d=0;d<c.exit-l-1;d++)i.push("  ");for(i.push(t+a),d=0;d<p-(c.exit-c.entry);d++)i.push(" "+e);var v=R>0?t:" ";i.push(v+r);var A=u+1+(c.exit-c.entry),x=new TextDiagram(A,u+1,i);c=c.appendRight(x,"")}else{i=[];var S=c.exit!=c.entry?" ":t;for(i.push(S+s),d=0;d<c.exit-c.entry-1;d++)i.push(" "+e);for(c.exit!=c.entry&&i.push(t+h),d=0;d<p-(c.exit-c.entry);d++)i.push(" "+e);i.push(t+h),x=new TextDiagram(c.exit-c.entry,0,i),c=c.appendRight(x,"")}}return c}}T.HorizontalChoice=(...w)=>new HorizontalChoice(...w);export class MultipleChoice extends DiagramMultiContainer{constructor(t,e,...r){if(super("g",r),typeof t!="number"||t!==Math.floor(t))throw new TypeError("The first argument of MultipleChoice() must be an integer.");if(t<0||t>=r.length)throw new RangeError("The first argument of MultipleChoice() must be an index for one of the items.");if(this.normal=t,e!="any"&&e!="all")throw new SyntaxError("The second argument of MultipleChoice must be 'any' or 'all'.");this.type=e,this.needsSpace=!0,this.innerWidth=C(this.items,function(s){return s.width}),this.width=30+Options.AR+this.innerWidth+Options.AR+20,this.up=this.items[0].up,this.down=this.items[this.items.length-1].down,this.height=this.items[t].height;for(var h=0;h<this.items.length;h++){let s=this.items[h],a;h==t-1||h==t+1?a=10+Options.AR:a=Options.AR,h<t?this.up+=Math.max(a,s.height+s.down+Options.VS+this.items[h+1].up):h>t&&(this.down+=Math.max(a,s.up+Options.VS+this.items[h-1].down+this.items[h-1].height))}this.down-=this.items[t].height,Options.DEBUG&&(this.attrs["data-updown"]=this.up+" "+this.height+" "+this.down,this.attrs["data-type"]="multiplechoice")}format(t,e,r){var h=b(r,this.width);new Path(t,e).right(h[0]).addTo(this),new Path(t+h[0]+this.width,e+this.height).right(h[1]).addTo(this),t+=h[0];for(var s=this.items[this.normal],a,n=this.normal-1;n>=0;n--){var u=this.items[n];n==this.normal-1&&(a=Math.max(10+Options.AR,s.up+Options.VS+u.down+u.height)),new Path(t+30,e).up(a-Options.AR).arc("wn").addTo(this),u.format(t+30+Options.AR,e-a,this.innerWidth).addTo(this),new Path(t+30+Options.AR+this.innerWidth,e-a+u.height).arc("ne").down(a-u.height+this.height-Options.AR-10).addTo(this),n!==0&&(a+=Math.max(Options.AR,u.up+Options.VS+this.items[n-1].down+this.items[n-1].height))}for(new Path(t+30,e).right(Options.AR).addTo(this),s.format(t+30+Options.AR,e,this.innerWidth).addTo(this),new Path(t+30+Options.AR+this.innerWidth,e+this.height).right(Options.AR).addTo(this),n=this.normal+1;n<this.items.length;n++){let l=this.items[n];n==this.normal+1&&(a=Math.max(10+Options.AR,s.height+s.down+Options.VS+l.up)),new Path(t+30,e).down(a-Options.AR).arc("ws").addTo(this),l.format(t+30+Options.AR,e+a,this.innerWidth).addTo(this),new Path(t+30+Options.AR+this.innerWidth,e+a+l.height).arc("se").up(a-Options.AR+l.height-s.height).addTo(this),n!=this.items.length-1&&(a+=Math.max(Options.AR,l.height+l.down+Options.VS+this.items[n+1].up))}var o=new FakeSVG("g",{class:"diagram-text"}).addTo(this);return new FakeSVG("title",{},this.type=="any"?"take one or more branches, once each, in any order":"take all branches, once each, in any order").addTo(o),new FakeSVG("path",{d:"M "+(t+30)+" "+(e-10)+" h -26 a 4 4 0 0 0 -4 4 v 12 a 4 4 0 0 0 4 4 h 26 z",class:"diagram-text"}).addTo(o),new FakeSVG("text",{x:t+15,y:e+4,class:"diagram-text"},this.type=="any"?"1+":"all").addTo(o),new FakeSVG("path",{d:"M "+(t+this.width-20)+" "+(e-10)+" h 16 a 4 4 0 0 1 4 4 v 12 a 4 4 0 0 1 -4 4 h -16 z",class:"diagram-text"}).addTo(o),new FakeSVG("path",{d:"M "+(t+this.width-13)+" "+(e-2)+" a 4 4 0 1 0 6 -1 m 2.75 -1 h -4 v 4 m 0 -3 h 2",style:"stroke-width: 1.75"}).addTo(o),this}toTextDiagram(){var[t]=TextDiagram._getParts(["multi_repeat"]);if(this.type=="any")var e=TextDiagram.rect("1+");else e=TextDiagram.rect("all");var r=Choice.prototype.toTextDiagram.call(this),h=TextDiagram.rect(t);return r=e.appendRight(r,""),r=r.appendRight(h,""),r}}T.MultipleChoice=(...w)=>new MultipleChoice(...w);export class Optional extends FakeSVG{constructor(t,e){if(e===void 0)return new Choice(1,new Skip,t);if(e==="skip")return new Choice(0,new Skip,t);throw"Unknown value for Optional()'s 'skip' argument."}}T.Optional=(...w)=>new Optional(...w);export class OneOrMore extends FakeSVG{constructor(t,e){super("g"),e=e||new Skip,this.item=I(t),this.rep=I(e),this.width=Math.max(this.item.width,this.rep.width)+Options.AR*2,this.height=this.item.height,this.up=this.item.up,this.down=Math.max(Options.AR*2,this.item.down+Options.VS+this.rep.up+this.rep.height+this.rep.down),this.needsSpace=!0,Options.DEBUG&&(this.attrs["data-updown"]=this.up+" "+this.height+" "+this.down,this.attrs["data-type"]="oneormore")}format(t,e,r){var h=b(r,this.width);new Path(t,e).h(h[0]).addTo(this),new Path(t+h[0]+this.width,e+this.height).h(h[1]).addTo(this),t+=h[0],new Path(t,e).right(Options.AR).addTo(this),this.item.format(t+Options.AR,e,this.width-Options.AR*2).addTo(this),new Path(t+this.width-Options.AR,e+this.height).right(Options.AR).addTo(this);var s=Math.max(Options.AR*2,this.item.height+this.item.down+Options.VS+this.rep.up);return new Path(t+Options.AR,e).arc("nw").down(s-Options.AR*2).arc("ws").addTo(this),this.rep.format(t+Options.AR,e+s,this.width-Options.AR*2).addTo(this),new Path(t+this.width-Options.AR,e+s+this.rep.height).arc("se").up(s-Options.AR*2+this.rep.height-this.item.height).arc("en").addTo(this),this}toTextDiagram(){var[t,e,r,h,s,a,n]=TextDiagram._getParts(["line","repeat_top_left","repeat_left","repeat_bot_left","repeat_top_right","repeat_right","repeat_bot_right"]),u=this.item.toTextDiagram(),o=this.rep.toTextDiagram(),l=TextDiagram._maxWidth(u,o);o=o.expand(0,l-o.width,0,0),u=u.expand(0,l-u.width,0,0);var p=u.appendBelow(o,[]),i=[];i.push(e+t);for(var d=0;d<u.height-u.entry+o.entry-1;d++)i.push(r+" ");i.push(h+t);var c=new TextDiagram(0,0,i);c=c.appendRight(p,"");var f=[];for(f.push(t+s),d=0;d<u.height-u.exit+o.exit-1;d++)f.push(" "+a);f.push(t+n);var m=new TextDiagram(0,0,f),g=c.appendRight(m,"");return g}walk(t){t(this),this.item.walk(t),this.rep.walk(t)}}T.OneOrMore=(...w)=>new OneOrMore(...w);export class ZeroOrMore extends FakeSVG{constructor(t,e,r){return new Optional(new OneOrMore(t,e),r)}}T.ZeroOrMore=(...w)=>new ZeroOrMore(...w);export class Group extends FakeSVG{constructor(t,e,r){super("g"),this.item=I(t),this.label=e instanceof FakeSVG?e:e?new Comment(e,{title:r?`${r}`:""}):void 0,this.width=Math.max(this.item.width+(this.item.needsSpace?20:0),this.label?this.label.width:0,Options.AR*2),this.height=this.item.height,this.boxUp=this.up=Math.max(this.item.up+Options.VS,Options.AR),this.label&&(this.up+=this.label.up+this.label.height+this.label.down),this.down=Math.max(this.item.down+Options.VS,Options.AR),this.needsSpace=!0,Options.DEBUG&&(this.attrs["data-updown"]=this.up+" "+this.height+" "+this.down,this.attrs["data-type"]="group")}format(t,e,r){var h=b(r,this.width);return new Path(t,e).h(h[0]).addTo(this),new Path(t+h[0]+this.width,e+this.height).h(h[1]).addTo(this),t+=h[0],new FakeSVG("rect",{x:t,y:e-this.boxUp,width:this.width,height:this.boxUp+this.height+this.down,rx:Options.AR,ry:Options.AR,class:"group-box"}).addTo(this),this.item.format(t,e,this.width).addTo(this),this.label&&this.label.format(t,e-(this.boxUp+this.label.down+this.label.height),this.label.width).addTo(this),this}toTextDiagram(){var t=TextDiagram.roundrect(this.item.toTextDiagram(),!0);if(this.label!=null){var e=this.label.toTextDiagram();t=e.appendBelow(t,[],!0,!0).expand(0,0,1,0)}return t}walk(t){t(this),this.item.walk(t),this.label.walk(t)}}T.Group=(...w)=>new Group(...w);export class Start extends FakeSVG{constructor({type:t="simple",label:e}={}){super("g"),this.width=20,this.height=0,this.up=10,this.down=10,this.type=t,e&&(this.label=""+e,this.width=Math.max(20,this.label.length*Options.CHAR_WIDTH+10)),Options.DEBUG&&(this.attrs["data-updown"]=this.up+" "+this.height+" "+this.down,this.attrs["data-type"]="start")}format(t,e){let r=new Path(t,e-10);return this.type==="complex"?r.down(20).m(0,-10).right(this.width).addTo(this):r.down(20).m(10,-20).down(20).m(-10,-10).right(this.width).addTo(this),this.label&&new FakeSVG("text",{x:t,y:e-15,style:"text-anchor:start"},this.label).addTo(this),this}toTextDiagram(){var[t,e,r]=TextDiagram._getParts(["cross","line","tee_right"]);if(this.type==="simple")var h=r+t+e;else h=r+e;var s=new TextDiagram(0,0,[]);this.label!=null&&(s=new TextDiagram(0,0,[this.label]),h=TextDiagram._padR(h,s.width,e));var a=new TextDiagram(0,0,[h]);return s.appendBelow(a,[],!0,!0)}}T.Start=(...w)=>new Start(...w);export class End extends FakeSVG{constructor({type:t="simple"}={}){super("path"),this.width=20,this.height=0,this.up=10,this.down=10,this.type=t,Options.DEBUG&&(this.attrs["data-updown"]=this.up+" "+this.height+" "+this.down,this.attrs["data-type"]="end")}format(t,e){return this.type==="complex"?this.attrs.d="M "+t+" "+e+" h 20 m 0 -10 v 20":this.attrs.d="M "+t+" "+e+" h 20 m -10 -10 v 20 m 10 -20 v 20",this}toTextDiagram(){var[t,e,r]=TextDiagram._getParts(["cross","line","tee_left"]);if(this.type==="simple")var h=e+t+r;else h=e+r;return new TextDiagram(0,0,[h])}}T.End=(...w)=>new End(...w);export class Terminal extends FakeSVG{constructor(t,{href:e,title:r,cls:h}={}){super("g",{class:["terminal",h].join(" ")}),this.text=""+t,this.href=e,this.title=r,this.cls=h,this.width=this.text.length*Options.CHAR_WIDTH+20,this.height=0,this.up=11,this.down=11,this.needsSpace=!0,Options.DEBUG&&(this.attrs["data-updown"]=this.up+" "+this.height+" "+this.down,this.attrs["data-type"]="terminal")}format(t,e,r){var h=b(r,this.width);new Path(t,e).h(h[0]).addTo(this),new Path(t+h[0]+this.width,e).h(h[1]).addTo(this),t+=h[0],new FakeSVG("rect",{x:t,y:e-11,width:this.width,height:this.up+this.down,rx:10,ry:10}).addTo(this);var s=new FakeSVG("text",{x:t+this.width/2,y:e+4},this.text);return this.href?new FakeSVG("a",{"xlink:href":this.href},[s]).addTo(this):s.addTo(this),this.title&&new FakeSVG("title",{},[this.title]).addTo(this),this}toTextDiagram(){return TextDiagram.roundrect(this.text)}}T.Terminal=(...w)=>new Terminal(...w);export class NonTerminal extends FakeSVG{constructor(t,{href:e,title:r,cls:h=""}={}){super("g",{class:["non-terminal",h].join(" ")}),this.text=""+t,this.href=e,this.title=r,this.cls=h,this.width=this.text.length*Options.CHAR_WIDTH+20,this.height=0,this.up=11,this.down=11,this.needsSpace=!0,Options.DEBUG&&(this.attrs["data-updown"]=this.up+" "+this.height+" "+this.down,this.attrs["data-type"]="nonterminal")}format(t,e,r){var h=b(r,this.width);new Path(t,e).h(h[0]).addTo(this),new Path(t+h[0]+this.width,e).h(h[1]).addTo(this),t+=h[0],new FakeSVG("rect",{x:t,y:e-11,width:this.width,height:this.up+this.down}).addTo(this);var s=new FakeSVG("text",{x:t+this.width/2,y:e+4},this.text);return this.href?new FakeSVG("a",{"xlink:href":this.href},[s]).addTo(this):s.addTo(this),this.title&&new FakeSVG("title",{},[this.title]).addTo(this),this}toTextDiagram(){return TextDiagram.rect(this.text)}}T.NonTerminal=(...w)=>new NonTerminal(...w);export class Comment extends FakeSVG{constructor(t,{href:e,title:r,cls:h=""}={}){super("g",{class:["comment",h].join(" ")}),this.text=""+t,this.href=e,this.title=r,this.cls=h,this.width=this.text.length*Options.COMMENT_CHAR_WIDTH+10,this.height=0,this.up=8,this.down=8,this.needsSpace=!0,Options.DEBUG&&(this.attrs["data-updown"]=this.up+" "+this.height+" "+this.down,this.attrs["data-type"]="comment")}format(t,e,r){var h=b(r,this.width);new Path(t,e).h(h[0]).addTo(this),new Path(t+h[0]+this.width,e+this.height).h(h[1]).addTo(this),t+=h[0];var s=new FakeSVG("text",{x:t+this.width/2,y:e+5,class:"comment"},this.text);return this.href?new FakeSVG("a",{"xlink:href":this.href},[s]).addTo(this):(s.addTo(this),new FakeSVG("text",{x:t+this.width+5,y:e+5,class:"collapseX"},["&#11198;"]).addTo(this)),this.title&&new FakeSVG("title",{},this.title).addTo(this),this}toTextDiagram(){return new TextDiagram(0,0,[this.text])}}T.Comment=(...w)=>new Comment(...w);export class Skip extends FakeSVG{constructor(){super("g"),this.width=0,this.height=0,this.up=0,this.down=0,this.needsSpace=!1,Options.DEBUG&&(this.attrs["data-updown"]=this.up+" "+this.height+" "+this.down,this.attrs["data-type"]="skip")}format(t,e,r){return new Path(t,e).right(r).addTo(this),this}toTextDiagram(){var[t]=TextDiagram._getParts(["line"]);return new TextDiagram(0,0,[t])}}T.Skip=(...w)=>new Skip(...w);export class Block extends FakeSVG{constructor({width:t=50,up:e=15,height:r=25,down:h=15,needsSpace:s=!0}={}){super("g"),this.width=t,this.height=r,this.up=e,this.down=h,this.needsSpace=!0,Options.DEBUG&&(this.attrs["data-updown"]=this.up+" "+this.height+" "+this.down,this.attrs["data-type"]="block")}format(t,e,r){var h=b(r,this.width);return new Path(t,e).h(h[0]).addTo(this),new Path(t+h[0]+this.width,e).h(h[1]).addTo(this),t+=h[0],new FakeSVG("rect",{x:t,y:e-this.up,width:this.width,height:this.up+this.height+this.down}).addTo(this),this}toTextDiagram(){return TextDiagram.rect("")}}T.Block=(...w)=>new Block(...w);export class TextDiagram{constructor(t,e,r){if(this.entry=t,this.exit=e,this.height=r.length,this.lines=Array.from(r),this.width=r.length>0?r[0].length:0,t>r.length)throw new Error(`Entry is not within diagram vertically:
`+this._dump(!1));if(e>r.length)throw new Error(`Exit is not within diagram vertically:
`+this._dump(!1));for(var h=0;h<r.length;h++)if(r[0].length!=r[h].length)throw new Error(`Diagram data is not rectangular:
`+this._dump(!1))}alter(t=null,e=null,r=null){var h=t||this.entry,s=e||this.exit,a=r||this.lines;return new TextDiagram(h,s,Array.from(a))}appendBelow(t,e,r=!1,h=!1){var s=Math.max(this.width,t.width),a=[],n=this.center(s," ").lines;for(const l of n)a.push(l);for(const l of e)a.push(TextDiagram._padR(l,s," "));n=t.center(s," ").lines;for(const l of n)a.push(l);var u=r?this.height+e.length+t.entry:this.entry,o=h?this.height+e.length+t.exit:this.exit;return new TextDiagram(u,o,a)}appendRight(t,e){for(var r=Math.max(this.exit,t.entry),h=Math.max(this.height-this.exit,t.height-t.entry)+r,s=r-this.exit,a=h-this.height-s,n=r-t.entry,u=h-t.height-n,o=this.expand(0,0,s,a),l=t.expand(0,0,n,u),p=[],i=0;i<h;i++){var d=i!=r?" ".repeat(e.length):e;p.push(o.lines[i]+d+l.lines[i])}var c=this.entry+s,f=t.exit+n;return new TextDiagram(c,f,p)}center(t,e){if(t<this.width)throw new Error("Cannot center into smaller width");if(t===this.width)return this.copy();for(var r=t-this.width,h=Math.trunc(r/2),s=[],a=0;a<this.height;a++)s.push(e.repeat(h));var n=[];for(a=0;a<this.height;a++)n.push(e.repeat(r-h));return new TextDiagram(this.entry,this.exit,TextDiagram._encloseLines(this.lines,s,n))}copy(){return new TextDiagram(this.entry,this.exit,Array.from(this.lines))}expand(t,e,r,h){if(t<0||e<0||r<0||h<0)throw new Error("Expansion values cannot be negative");if(t+e+r+h===0)return this.copy();for(var s=TextDiagram.parts.line,a=[],n=0;n<r;n++)a.push(" ".repeat(this.width+t+e));for(n=0;n<this.height;n++){var u=n===this.entry?s:" ",o=n===this.exit?s:" ";a.push(u.repeat(t)+this.lines[n]+o.repeat(e))}for(n=0;n<h;n++)a.push(" ".repeat(this.width+t+e));return new TextDiagram(this.entry+r,this.exit+r,a)}static rect(t,e=!1){return TextDiagram._rectish("rect",t,e)}static roundrect(t,e=!1){return TextDiagram._rectish("roundrect",t,e)}static setFormatting(t=null,e=null){t!==null&&(TextDiagram.parts={},e!==null&&(TextDiagram.parts=Object.assign(Object.assign({},TextDiagram.parts),e)),TextDiagram.parts=Object.assign(Object.assign({},TextDiagram.parts),t));for(const[r,h]of TextDiagram.parts)h.length!=1&&""+r+h}_dump(t=!0){var e=`
`,r="height="+this.height+" lines.length="+this.lines.length;this.entry>this.lines.length&&(r+="; entry outside diagram: entry="+this.entry),this.exit>this.lines.length&&(r+="; exit outside diagram: exit="+this.exit);for(var h=0;h<Math.max(this.lines.length,this.entry+1,this.exit+1);h++)r=r+e+"["+("00"+h).slice(-3)+"]",h<this.lines.length&&(r+=" '"+this.lines[h]+"' len="+this.lines[h].length),h===this.entry&&h===this.exit?r+=" <- entry, exit":h===this.entry?r+=" <- entry":h===this.exit&&(r+=" <- exit");return t&&console.log(r),r}static _encloseLines(t,e,r){if(t.length!=e.length)throw new Error("All arguments must be the same length");if(t.length!=r.length)throw new Error("All arguments must be the same length");for(var h=[],s=0;s<t.length;s++)h.push(e[s]+t[s]+r[s]);return h}static _gaps(t,e){var r=t-e;if(Options.INTERNAL_ALIGNMENT==="left")return[0,r];if(Options.INTERNAL_ALIGNMENT==="right")return[r,0];var h=Math.trunc(r/2),s=r-h;return[h,s]}static _getParts(t){var e=[];for(const r of t){if(TextDiagram.parts[r]==null)throw new Error("Text diagram part "+r+"not found.");e.push(TextDiagram.parts[r])}return e}static _maxWidth(...t){var e=0;for(const h of t){if(h instanceof TextDiagram)var r=h.width;else h instanceof Array?r=Math.max(h.map(function(s){return s.length})):Number.isInteger(h)?r=Number.toString(h).length:r=h.length;e=r>e?r:e}return e}static _padL(t,e,r){if((e-t.length)%r.length!=0)throw new Error("Gap "+(e-t.length)+" must be a multiple of pad string '"+r+"'");return r.repeat(Math.trunc(e-t.length/r.length))+t}static _padR(t,e,r){if((e-t.length)%r.length!=0)throw new Error("Gap "+(e-t.length)+" must be a multiple of pad string '"+r+"'");return t+r.repeat(Math.trunc(e-t.length/r.length))}static _rectish(t,e,r=!1){var h=r?"_dashed":"",[s,a,n,u,o,l,p,i,d,c]=TextDiagram._getParts([t+"_top_left",t+"_left"+h,t+"_bot_left",t+"_top_right",t+"_right"+h,t+"_bot_right",t+"_top"+h,t+"_bot"+h,"line","cross"]),f=e instanceof TextDiagram;if(f)var m=e;else m=new TextDiagram(0,0,[e]);var g=[];if(g.push(p.repeat(m.width+2)),f)g+=m.expand(1,1,0,0).lines;else for(var _=0;_<m.lines.length;_++)g.push(" "+m.lines[_]+" ");g.push(i.repeat(m.width+2));var M=m.entry+1,v=m.exit+1,A=TextDiagram._maxWidth(s,a,n),x=[];for(x.push(TextDiagram._padR(s,A,p)),_=1;_<g.length-1;_++)x.push(TextDiagram._padR(a,A," "));x.push(TextDiagram._padR(n,A,i)),f&&(x[M]=c);var S=TextDiagram._maxWidth(u,o,l),R=[];for(R.push(TextDiagram._padL(u,S,p)),_=1;_<g.length-1;_++)R.push(TextDiagram._padL(o,S," "));for(R.push(TextDiagram._padL(l,S,i)),f&&(R[v]=c),g=TextDiagram._encloseLines(g,x,R),x=[],_=0;_<g.length;_++)x.push(" ");for(x[M]=d,R=[],_=0;_<g.length;_++)R.push(" ");return R[v]=d,g=TextDiagram._encloseLines(g,x,R),new TextDiagram(M,v,g)}}TextDiagram.PARTS_UNICODE={cross_diag:"\u2573",corner_bot_left:"\u2514",corner_bot_right:"\u2518",corner_top_left:"\u250C",corner_top_right:"\u2510",cross:"\u253C",left:"\u2502",line:"\u2500",line_vertical:"\u2502",multi_repeat:"\u21BA",rect_bot:"\u2500",rect_bot_dashed:"\u2504",rect_bot_left:"\u2514",rect_bot_right:"\u2518",rect_left:"\u2502",rect_left_dashed:"\u2506",rect_right:"\u2502",rect_right_dashed:"\u2506",rect_top:"\u2500",rect_top_dashed:"\u2504",rect_top_left:"\u250C",rect_top_right:"\u2510",repeat_bot_left:"\u2570",repeat_bot_right:"\u256F",repeat_left:"\u2502",repeat_right:"\u2502",repeat_top_left:"\u256D",repeat_top_right:"\u256E",right:"\u2502",roundcorner_bot_left:"\u2570",roundcorner_bot_right:"\u256F",roundcorner_top_left:"\u256D",roundcorner_top_right:"\u256E",roundrect_bot:"\u2500",roundrect_bot_dashed:"\u2504",roundrect_bot_left:"\u2570",roundrect_bot_right:"\u256F",roundrect_left:"\u2502",roundrect_left_dashed:"\u2506",roundrect_right:"\u2502",roundrect_right_dashed:"\u2506",roundrect_top:"\u2500",roundrect_top_dashed:"\u2504",roundrect_top_left:"\u256D",roundrect_top_right:"\u256E",separator:"\u2500",tee_left:"\u2524",tee_right:"\u251C"},TextDiagram.PARTS_ASCII={cross_diag:"X",corner_bot_left:"\\",corner_bot_right:"/",corner_top_left:"/",corner_top_right:"\\",cross:"+",left:"|",line:"-",line_vertical:"|",multi_repeat:"&",rect_bot:"-",rect_bot_dashed:"-",rect_bot_left:"+",rect_bot_right:"+",rect_left:"|",rect_left_dashed:"|",rect_right:"|",rect_right_dashed:"|",rect_top_dashed:"-",rect_top:"-",rect_top_left:"+",rect_top_right:"+",repeat_bot_left:"\\",repeat_bot_right:"/",repeat_left:"|",repeat_right:"|",repeat_top_left:"/",repeat_top_right:"\\",right:"|",roundcorner_bot_left:"\\",roundcorner_bot_right:"/",roundcorner_top_left:"/",roundcorner_top_right:"\\",roundrect_bot:"-",roundrect_bot_dashed:"-",roundrect_bot_left:"\\",roundrect_bot_right:"/",roundrect_left:"|",roundrect_left_dashed:"|",roundrect_right:"|",roundrect_right_dashed:"|",roundrect_top:"-",roundrect_top_dashed:"-",roundrect_top_left:"/",roundrect_top_right:"\\",separator:"-",tee_left:"|",tee_right:"|"},TextDiagram.parts=TextDiagram.PARTS_UNICODE;function k(...w){return w.reduce(function(t,e){return t!==void 0?t:e})}function b(w,t){var e=w-t;switch(Options.INTERNAL_ALIGNMENT){case"left":return[0,e];case"right":return[e,0];default:return[e/2,e/2]}}function I(w){return w instanceof FakeSVG?w:new Terminal(""+w)}function B(w,t){return t||(t=function(e){return e}),w.map(t).reduce(function(e,r){return e+r},0)}function C(w,t=e=>e){return Math.max.apply(null,w.map(t))}function G(w,t,e){t=t||{},e=e||"";var r=document.createElementNS("http://www.w3.org/2000/svg",w);for(var h in t)h==="xlink:href"?r.setAttributeNS("http://www.w3.org/1999/xlink","href",t[h]):r.setAttribute(h,t[h]);return r.textContent=e,r}function O(w){return w.replace(/[*_\`\[\]<&]/g,function(t){return"&#"+t.charCodeAt(0)+";"})}function*V(w){var t=0;for(const e of w)yield[t,e],t++}
