<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Test</title>
		<script type="module">
     		import { Diagram } from "./js.min/Diagram.js";

			window.asyncGenerateDiagram = async function(grammar) {
				console.log("Generating diagramâ€¦");
				return new Promise((resolve, reject) => {
					// Timeout to prevent blocking the UI or freezing the browser
					setTimeout(() => {
						console.debug("Generation Timeout");
						reject()
					}, 10);

					try {
						// Generate the diagram
						const d = Diagram.fromString(grammar);
						console.debug("Finished generating diagram.")
						resolve(d);
					} catch (e) {
						reject(e);
					}
				});
			}

			window.handleGenerateDiagram = function() {
				const ebnfGrammarValue = document.querySelector("textarea[name=ebnf_grammar]").value;
				if (ebnfGrammarValue.trim() === "") {
					console.warn("Nothing was entered into the textarea.")
					return false;
				}

				asyncGenerateDiagram(ebnfGrammarValue).then((diagram) =>
				{
					document.getElementById("visualized_ebnf").innerHTML = diagram.toHtmlTag([1, 3, 8])
				}).catch(e => console.error(e));
			}
		</script>
	</head>
	<body>
		<h1>EBNF Visualizer</h1>
		<h2>Grammar</h2>
		<textarea autofocus="true" name="ebnf_grammar" placeholder="EBNF-Grammar in Wirth Syntax Notation" oninput="handleGenerateDiagram()"></textarea>
		<h2>Railroad Diagram</h2>
    	<div id="visualized_ebnf">
			<!-- Diagram will be inserted here -->
		</div>
	</body>
</html>